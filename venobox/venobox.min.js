/* 
 * VenoBox - jQuery Plugin
 * version: 1.5.0
 * @requires jQuery
 *
 * Examples at http://lab.veno.it/venobox/
 * License: Creative Commons Attribution 3.0 License
 * License URI: http://creativecommons.org/licenses/by/3.0/
 * Copyright 2013-2014 Nicola Franchini - @nicolafranchini
 *
 */
(function(e){function M(){e.ajax({url:f,cache:false}).done(function(e){u.html('<div class="vbox-inline">'+e+"</div>");j(true)}).fail(function(){u.html('<div class="vbox-inline"><p>Error retrieving contents, please retry</div>');j(true)})}function _(){u.html('<iframe class="venoframe" src="'+f+'"></iframe>');j()}function D(){var e=f.split("/");var t=e[e.length-1];u.html('<iframe class="venoframe" src="//player.vimeo.com/video/'+t+'"></iframe>');j()}function P(){var e=f.split("/");var t=e[e.length-1];u.html('<iframe class="venoframe" allowfullscreen src="//www.youtube.com/embed/'+t+'"></iframe>');j()}function H(){u.html('<div class="vbox-inline">'+e(f).html()+"</div>");j()}function B(){d=e(".vbox-content").find("img");d.one("load",function(){j()}).each(function(){if(this.complete)e(this).load()})}function j(t){t=t||false;if(t!=true){e(window).scrollTop(0)}T.html(w);u.find(">:first-child").addClass("figlio");e(".figlio").css("width",framewidth).css("height",frameheight).css("padding",border).css("background",bgcolor);c=u.outerHeight();h=e(window).height();if(c+80<h){p=(h-c)/2;u.css("margin-top",p);u.css("margin-bottom",p)}else{u.css("margin-top","40px");u.css("margin-bottom","40px")}u.animate({opacity:"1"},"slow")}function F(){if(e(".vbox-content").length){c=u.height();h=e(window).height();if(c+80<h){p=(h-c)/2;u.css("margin-top",p);u.css("margin-bottom",p)}else{u.css("margin-top","40px");u.css("margin-bottom","40px")}}}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;e.fn.extend({venobox:function(c){var h={framewidth:"",frameheight:"",border:"0",bgcolor:"#fff",titleattr:"title",numeratio:false,infinigall:false};var c=e.extend(h,c);return this.each(function(){var h=e(this);if(h.data("venobox")){return true}h.addClass("vbox-item");h.data("framewidth",c.framewidth);h.data("frameheight",c.frameheight);h.data("border",c.border);h.data("bgcolor",c.bgcolor);h.data("numeratio",c.numeratio);h.data("infinigall",c.infinigall);h.data("venobox",true);t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?true:false;n=document.all&&!window.atob?true:false;h.click(function(p){function d(){m=h.data("gall");numeratio=h.data("numeratio");infinigall=h.data("infinigall");g=e('.vbox-item[data-gall="'+m+'"]');if(g.length>0&&numeratio===true){N.html(g.index(h)+1+" / "+g.length);N.fadeIn()}else{N.fadeOut()}y=g.eq(g.index(h)+1);b=g.eq(g.index(h)-1);if(h.attr(c.titleattr)){w=h.attr(c.titleattr);T.fadeIn()}else{w="";T.fadeOut()}if(g.length>0&&infinigall===true){E=true;S=true;if(y.length<1){y=g.eq(0)}if(g.index(h)<1){b=g.eq(g.index(g.length))}}else{if(y.length>0){e(".vbox-next").css("display","block");E=true}else{e(".vbox-next").css("display","none");E=false}if(g.index(h)>0){e(".vbox-prev").css("display","block");S=true}else{e(".vbox-prev").css("display","none");S=false}}}function j(e){if(e.keyCode===27){F()}}function F(){e("body").unbind("keydown",j);if(n){i.animate({opacity:0},500,function(){i.remove();e(".vwrap").children().unwrap();e(window).scrollTop(-l);x=false;h.focus()})}else{i.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");i.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(n){if(n.target!=n.currentTarget){return}i.remove();if(t){e(".vwrap").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){e(".vwrap").children().unwrap();e(window).scrollTop(-l)});e(".vwrap").css("opacity","1")}else{e(".vwrap").children().unwrap();e(window).scrollTop(-l)}x=false;h.focus()});i.css("opacity","0")}}p.stopPropagation();p.preventDefault();h=e(this);r=h.data("overlay");framewidth=h.data("framewidth");frameheight=h.data("frameheight");border=h.data("border");bgcolor=h.data("bgcolor");E=false;S=false;x=false;f=h.attr("href");l=e(window).scrollTop();l=-l;O=h.data("css")||"";e("body").wrapInner('<div class="vwrap"></div>');s=e(".vwrap");a='<div class="vbox-overlay '+O+'" style="background:'+r+'"><div class="vbox-preloader">Loading...</div><div class="vbox-container"><div class="vbox-content"></div></div><div class="vbox-title"></div><div class="vbox-num">0/0</div><div class="vbox-close">X</div><div class="vbox-next">next</div><div class="vbox-prev">prev</div></div>';e("body").append(a);i=e(".vbox-overlay");o=e(".vbox-container");u=e(".vbox-content");N=e(".vbox-num");T=e(".vbox-title");u.html("");u.css("opacity","0");d();i.css("min-height",e(window).outerHeight());if(n){i.animate({opacity:1},250,function(){i.css({"min-height":e(window).outerHeight(),height:"auto"});if(h.data("type")=="iframe"){_()}else if(h.data("type")=="inline"){H()}else if(h.data("type")=="ajax"){M()}else if(h.data("type")=="vimeo"){D()}else if(h.data("type")=="youtube"){P()}else{u.html('<img src="'+f+'">');B()}})}else{i.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(t){if(t.target!=t.currentTarget){return}i.css({"min-height":e(window).outerHeight(),height:"auto"});if(h.data("type")=="iframe"){_()}else if(h.data("type")=="inline"){H()}else if(h.data("type")=="ajax"){M()}else if(h.data("type")=="vimeo"){D()}else if(h.data("type")=="youtube"){P()}else{u.html('<img src="'+f+'">');B()}});i.css("opacity","1")}if(t){s.css({position:"fixed",top:l,opacity:"0"}).data("top",l)}else{s.css({position:"fixed",top:l}).data("top",l);e(window).scrollTop(0)}var v={prev:function(){if(x)return;else x=true;r=b.data("overlay");framewidth=b.data("framewidth");frameheight=b.data("frameheight");border=b.data("border");bgcolor=b.data("bgcolor");f=b.attr("href");if(b.attr(c.titleattr)){w=b.attr(c.titleattr)}else{w=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight());u.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(b.data("type")=="iframe"){_()}else if(b.data("type")=="inline"){H()}else if(b.data("type")=="ajax"){M()}else if(b.data("type")=="youtube"){P()}else if(b.data("type")=="vimeo"){D()}else{u.html('<img src="'+f+'">');B()}h=b;d();x=false})},next:function(){if(x)return;else x=true;r=y.data("overlay");framewidth=y.data("framewidth");frameheight=y.data("frameheight");border=y.data("border");bgcolor=y.data("bgcolor");f=y.attr("href");if(y.attr(c.titleattr)){w=y.attr(c.titleattr)}else{w=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight());u.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(y.data("type")=="iframe"){_()}else if(y.data("type")=="inline"){H()}else if(y.data("type")=="ajax"){M()}else if(y.data("type")=="youtube"){P()}else if(y.data("type")=="vimeo"){D()}else{u.html('<img src="'+f+'">');B()}h=y;d();x=false})}};e("body").keydown(function(e){if(e.keyCode==37&&S==true){v.prev()}if(e.keyCode==39&&E==true){v.next()}});e(".vbox-prev").click(function(){v.prev()});e(".vbox-next").click(function(){v.next()});e(".vbox-close, .vbox-overlay").click(function(t){L=".figlio";k=".vbox-prev";C=".vbox-next";A=".figlio *";if(!e(t.target).is(L)&&!e(t.target).is(C)&&!e(t.target).is(k)&&!e(t.target).is(A)){F()}});e("body").keydown(j);return false})})}});e(window).resize(function(){F()})})(jQuery);
